# Stock AI Agent System - Master Prompt

## 系统概述

构建一个智能股票问答 AI Agent 系统，能够理解用户关于股票市场的各类问题，并通过查询数据库、计算技术指标、分析财务数据等方式提供专业的投资分析建议。

## 核心能力要求

### 1. 问题理解与意图识别
- **自然语言理解**：理解用户的中文/英文问题，识别股票代码、时间范围、指标名称等关键实体
- **意图分类**：将问题分类到具体的查询类型（价格查询、技术分析、基本面比如财务情况分析等、新闻事件等）
- **问题拆解**：将复杂问题拆解成多个子问题，按依赖关系顺序执行

### 2. 技术分析能力（Technical Analysis）

#### 2.1 价格数据查询
- 实时价格查询（当前价、开盘价、最高价、最低价、成交量）
- 历史价格序列查询（日K、周K、月K线数据）
- 价格变动分析（涨跌幅、涨跌额、换手率）
- 价格区间统计（最近N日的最高/最低价、平均价）

#### 2.2 技术指标计算与分析
**趋势指标**：
- MA（移动平均线）：SMA, EMA, WMA
- MACD（指数平滑异同移动平均线）
- SAR（抛物线指标）
- BOLL（布林带）
- DMI/ADX（趋向指标）

**动量指标**：
- RSI（相对强弱指标）
- KDJ（随机指标）
- CCI（顺势指标）
- WR（威廉指标）
- Momentum（动量指标）

**成交量指标**：
- OBV（能量潮）
- VOL（成交量）
- VWAP（成交量加权平均价）
- VRSI（量相对强弱指标）

**波动率指标**：
- ATR（真实波动幅度）
-布林带宽度
- 历史波动率

#### 2.3 形态识别与策略分析
- K线形态识别（锤子线、十字星、吞没形态等）
- 趋势判断（上升趋势、下降趋势、震荡整理）
- 支撑位/阻力位识别
- 金叉/死叉信号检测
- 超买/超卖判断
- 背离分析（顶背离、底背离）

### 3. 基本面分析能力（Fundamental Analysis）

#### 3.1 财务数据查询
**资产负债表**：
- 总资产、净资产
- 流动资产、固定资产
- 流动负债、长期负债
- 资产负债率、流动比率、速动比率

**利润表**：
- 营业收入、营业成本
- 净利润、毛利润
- EPS（每股收益）
- 营收增长率、利润增长率

**现金流量表**：
- 经营活动现金流
- 投资活动现金流
- 筹资活动现金流
- 自由现金流

#### 3.2 财务指标分析
**盈利能力**：
- ROE（净资产收益率）
- ROA（总资产收益率）
- 毛利率、净利率
- ROIC（投资资本回报率）

**偿债能力**：
- 资产负债率
- 流动比率、速动比率
- 利息保障倍数

**运营能力**：
- 应收账款周转率
- 存货周转率
- 总资产周转率

**成长能力**：
- 营收增长率
- 利润增长率
- 净资产增长率

**估值指标**：
- P/E（市盈率）
- P/B（市净率）
- P/S（市销率）
- PEG（市盈增长比率）
- EV/EBITDA

#### 3.3 财务健康度评估
- 杜邦分析
- 财务风险评级
- 同行业对比分析
- 财务造假风险检测（Beneish M-Score等）

### 4. 信息与事件分析能力（Information & Events）

#### 4.1 公司公告
- 业绩预告/快报
- 定期报告（年报、季报）
- 重大事项公告（并购重组、股权变动、诉讼仲裁）
- 分红派息公告
- 股东大会决议
- 监管函件

#### 4.2 新闻与舆情
- 公司新闻（产品发布、合作协议、管理层变动）
- 行业新闻（政策变化、行业趋势）
- 市场热点（板块轮动、概念炒作）
- 负面新闻监控
- 舆情情感分析（正面/负面/中性）

#### 4.3 资金流向
- 主力资金净流入/流出
- 北向资金（陆股通）
- 机构持仓变化
- 大宗交易
- 融资融券数据

#### 4.4 研报与评级
- 券商研报摘要
- 分析师评级（买入/持有/卖出）
- 目标价预测
- 一致预期（盈利预测）

### 5. 宏观与行业分析能力

#### 5.1 宏观经济数据
- GDP、CPI、PPI
- 利率、汇率
- 货币供应量
- 进出口数据

#### 5.2 行业分析
- 行业分类与概念板块
- 行业景气度指标
- 行业龙头对比
- 产业链上下游分析

#### 5.3 市场情绪
- 市场宽度指标（涨跌家数比）
- 恐慌指数（VIX等）
- 融资融券余额
- 新增开户数

### 6. 投资组合与回测能力

#### 6.1 投资组合分析
- 持仓收益率计算
- 资产配置建议
- 风险分散度评估
- 夏普比率、最大回撤

#### 6.2 策略回测
- 技术指标策略回测
- 多因子策略回测
- 事件驱动策略回测
- 回测结果可视化

### 7. 风险提示与合规

#### 7.1 风险提示
- 市场风险警示
- 个股风险等级
- ST/退市风险
- 流动性风险

#### 7.2 合规要求
- 不提供具体买卖建议（仅供参考）
- 披露数据来源与时效性
- 历史数据不代表未来表现
- 投资需谨慎声明

## 数据需求清单

### 必需数据源
1. **行情数据**：实时价格、历史K线、成交量
2. **财务数据**：三大报表、财务指标
3. **公告数据**：上市公司公告全文
4. **新闻数据**：财经新闻、公司新闻
5. **股票基础信息**：股票代码、名称、所属行业、上市日期

### 可选数据源
1. 研报数据
2. 资金流向数据
3. 机构持仓数据
4. 融资融券数据
5. 大股东持股数据
6. 高管持股及交易数据

## 典型用户问题示例

### 技术分析类
- "帮我查一下GOOGLE最近的股价表现"
- "根据不同的技术指标及策略,分析赛力斯的股价目前处于什么位置，是否值得买入"
- "分析宁德时代的MACD指标，是否有买入信号"
- "查询腾讯控股的RSI值，是否处于超买或超卖区域"
- "对比万科A和保利地产最近3个月的涨跌幅"

### 基本面分析类
- "查询茅台2025年的ROE和净利润增长率"
- "分析宁德时代的财务健康状况"
- "对比五粮液和泸州老窖的盈利能力"
- "招商银行的资产负债率是多少？是否健康？"
- "查询比亚迪的市盈率和市净率，估值是否合理"

### 信息事件类
- "GOOGLE什么时间公布财报？"
- "快手最近有什么利好或利空消息？"
- "阿里巴巴最近业务上有什么大动作?"
- "查询腾讯控股的北向资金流向"
- "隆基绿能最近有负面新闻吗？"

### 综合分析类
- "从技术面和基本面分析，茅台现在值得投资吗？"
- "帮我找出医药行业中ROE>15%且处于上升趋势的股票"
- "分析新能源汽车板块的龙头股票并对比"
- "给我一个适合长期持有的价值股推荐策略"
- "阿里巴巴的AI发展前景如何看待,未来一年的股价走势怎么看"
- "结合快手AI业务发展情况，结合股价的走势，帮我深度分析一下现在这个位置风险情况，以及后续走势判断"


## 系统架构建议

### Agent 核心业务模块
1. **Intent Understanding Module**（意图理解模块）
   - 实体识别（NER）：股票代码、时间、指标名称
   - 意图分类：查询类型识别
   - 问题拆解：复杂问题分解

2. **Query Planning Module**（查询规划模块）
   - 生成执行计划（查询顺序、数据依赖）
   - 工具选择（选择合适的工具/API）
   - 参数提取（从问题中提取查询参数）

3. **Data Retrieval Module**（数据检索模块）
   - 数据库查询执行器
   - API调用管理器
   - 缓存管理

4. **Computation Module**（计算模块）
   - 技术指标计算引擎
   - 财务指标计算引擎
   - 统计分析引擎

5. **Analysis & Reasoning Module**（分析推理模块）
   - 趋势判断逻辑
   - 信号检测逻辑
   - 多维度综合分析

6. **Response Generation Module**（回复生成模块）
   - 结构化结果组织
   - 自然语言生成
   - 可视化图表生成

### 技术栈建议
- **LLM**: OpenAI GPT-4, Claude, 或国内大模型（智谱、通义千问）
- **Agent Framework**: LangGraph+PydanticAI
- **数据库**: Supabase/PostgreSQL(结构化数据,向量数据), MongoDB (文档数据), Redis (缓存)
- **计算库**: pandas, numpy, talib (技术指标)
- **可视化**: matplotlib, plotly, echarts
- **数据源**: yfinance（美股、港股）, akshare(中国A股) 

## 评估指标

1. **准确性**：查询结果的准确率、计算指标的正确性
2. **完整性**：能否回答多维度的复杂问题
3. **时效性**：数据更新频率、查询响应时间
4. **可解释性**：分析逻辑是否清晰、结论是否有依据
5. **用户满意度**：回答的相关性、实用性

## 扩展方向

1. **对话式交互**：多轮对话、上下文理解
2. **多模态输入**：图片识别（上传K线图）、语音对话
3. **实时预警**：价格突破、技术指标信号、公告监控
4. **个性化推荐**：基于用户画像的股票推荐

